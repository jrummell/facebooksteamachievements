IF object_id(N'[dbo].[FK_steam_UserAchievement_steam_User]', N'F') IS NOT NULL
    ALTER TABLE [dbo].[steam_UserAchievement] DROP CONSTRAINT [FK_steam_UserAchievement_steam_User]
IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_FacebookUserId' AND object_id = object_id(N'[dbo].[steam_UserAchievement]', N'U'))
    DROP INDEX [IX_FacebookUserId] ON [dbo].[steam_UserAchievement]
ALTER TABLE [dbo].[steam_User] DROP CONSTRAINT [PK_steam_User]
CREATE TABLE [dbo].[UserClaim] (
    [Id] [int] NOT NULL IDENTITY,
    [UserId] [int] NOT NULL,
    [ClaimType] [nvarchar](max),
    [ClaimValue] [nvarchar](max),
    CONSTRAINT [PK_dbo.UserClaim] PRIMARY KEY ([Id])
)
CREATE INDEX [IX_UserId] ON [dbo].[UserClaim]([UserId])
CREATE TABLE [dbo].[UserLogin] (
    [Id] [int] NOT NULL IDENTITY,
    [LoginProvider] [nvarchar](max),
    [ProviderKey] [nvarchar](max),
    [UserId] [int] NOT NULL,
    CONSTRAINT [PK_dbo.UserLogin] PRIMARY KEY ([Id])
)
CREATE INDEX [IX_UserId] ON [dbo].[UserLogin]([UserId])
CREATE TABLE [dbo].[UserRole] (
    [Id] [int] NOT NULL IDENTITY,
    [UserId] [int] NOT NULL,
    [RoleId] [int] NOT NULL,
    CONSTRAINT [PK_dbo.UserRole] PRIMARY KEY ([Id])
)
CREATE INDEX [IX_UserId] ON [dbo].[UserRole]([UserId])
CREATE INDEX [IX_RoleId] ON [dbo].[UserRole]([RoleId])
CREATE TABLE [dbo].[Role] (
    [Id] [int] NOT NULL IDENTITY,
    [Name] [nvarchar](max),
    CONSTRAINT [PK_dbo.Role] PRIMARY KEY ([Id])
)
ALTER TABLE [dbo].[steam_UserAchievement] ADD [UserId] [int] NOT NULL DEFAULT 0
ALTER TABLE [dbo].[steam_User] ADD [Id] [int] NOT NULL IDENTITY
ALTER TABLE [dbo].[steam_User] ADD [Email] [nvarchar](max)
ALTER TABLE [dbo].[steam_User] ADD [EmailConfirmed] [bit] NOT NULL DEFAULT 0
ALTER TABLE [dbo].[steam_User] ADD [PasswordHash] [nvarchar](max)
ALTER TABLE [dbo].[steam_User] ADD [SecurityStamp] [nvarchar](max)
ALTER TABLE [dbo].[steam_User] ADD [PhoneNumber] [nvarchar](max)
ALTER TABLE [dbo].[steam_User] ADD [PhoneNumberConfirmed] [bit] NOT NULL DEFAULT 0
ALTER TABLE [dbo].[steam_User] ADD [TwoFactorEnabled] [bit] NOT NULL DEFAULT 0
ALTER TABLE [dbo].[steam_User] ADD [LockoutEndDateUtc] [datetime]
ALTER TABLE [dbo].[steam_User] ADD [LockoutEnabled] [bit] NOT NULL DEFAULT 0
ALTER TABLE [dbo].[steam_User] ADD [AccessFailedCount] [int] NOT NULL DEFAULT 0
ALTER TABLE [dbo].[steam_User] ADD [UserName] [nvarchar](max)
ALTER TABLE [dbo].[steam_User] ADD CONSTRAINT [PK_dbo.steam_User] PRIMARY KEY ([Id])
CREATE INDEX [IX_UserId] ON [dbo].[steam_UserAchievement]([UserId])
CREATE UNIQUE INDEX [IX_FacebookUserId] ON [dbo].[steam_User]([FacebookUserId])

update [steam_UserAchievement] set UserId = (select top(1) u.Id from steam_User as u where [steam_UserAchievement].FacebookUserId = u.FacebookUserId)

ALTER TABLE [dbo].[steam_UserAchievement] ADD CONSTRAINT [FK_dbo.steam_UserAchievement_dbo.steam_User_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[steam_User] ([Id])
ALTER TABLE [dbo].[UserClaim] ADD CONSTRAINT [FK_dbo.UserClaim_dbo.steam_User_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[steam_User] ([Id])
ALTER TABLE [dbo].[UserLogin] ADD CONSTRAINT [FK_dbo.UserLogin_dbo.steam_User_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[steam_User] ([Id])
ALTER TABLE [dbo].[UserRole] ADD CONSTRAINT [FK_dbo.UserRole_dbo.Role_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[Role] ([Id])
ALTER TABLE [dbo].[UserRole] ADD CONSTRAINT [FK_dbo.UserRole_dbo.steam_User_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[steam_User] ([Id])
INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
VALUES (N'201511030026084_AddIdentity', N'SteamAchievements.Data.Migrations.Configuration',  0x1F8B0800000000000400ED5DDB6EE4B8117D0F907F10F49404DE69DB930D12A37B17B39EF1AE91B961DA5EE46D404B745B185D7A25CA6B23C897EDC37E527E21A4AEBC8BA4D4EAF6C418C0B045F11459AC2A5691AA9AFFFEF6FBF2FB8724F6EE615E4459BAF24F5E1CFB1E4C832C8CD2CDCA2FD1ED377FF7BFFFEE8F7F58BE099307EFE7F6BD97E43DDC332D56FE1D42DBB3C5A208EE60028A174914E45991DDA21741962C40982D4E8F8FFFB1383959400CE1632CCF5B7E2A531425B0FA03FF799EA501DCA212C4EFB210C645F31CB7AC2B54EF3D4860B105015CF96B0441F22AB88BE03D4C608A8A17AF0102BEF72A8E001ECD1AC6B7BE07D2344300E1B19E5D17708DF22CDDACB7F80188AF1EB710BF770BE202367338EB5F379DCEF12999CEA2EFD842056581B2C412F0E465C39F05DFDD89CB7EC73FCCC13798D3E891CCBAE2E2CA2F08033F531C248F7D8FA77C761EE7A4978AE32FA438479EFCEDA34E76B088917F47DE7919A33287AB14962807F191F7B1BC89A3E09FF0F12AFB02D3555AC6313D133C17DCC63CC08F3EE6D916E6E8F113BC6DE67719FADE82EDB7E03B76DDA83EF5642F53F4F2D4F7DE63E2E026869DA0508C59A32C873FC214E600C1F0234008E629C18015AB05EA1C2D8A37C364F5506F41BA29C106B62858D0B1DEFADE3BF0F016A61B74B7F24FB1A25E440F306C1F34C0D76984B5BC276449B9961935D56F87C8A2BCB4A7FA1A16411E6D6BC550123F393E9E86FA7B701F6DAA35572FA1EF7D8271F54E71176D6BFB23AA06AF26051E5F9E259FB258A690C2DB9FAF40BE8198D65566DC659D9579C0CD69B9E8AD819D8D98C23E3CDB8661DBB08D0634EB6450B6DD14FA47FC73AC39BA4CB02DBACE63AD399A68F826BAD968DA1C0ADA6A9B8582B63A6D3A31ECC8E4B4EE184E4CECA69B18FFB6C1C4842EB289595A1E0ED3D9FA7038CF1668D0025D6027FB26CBBE10CE3174FFF6576B7B30A1A78357A9B38AE4F7AB28B1B771D5121677B01BCB0F199669905A03FD1485989D635104169BF065429F64A46518F64994C6C4C6E46926C3E17FAE5FE727217B4B61D6A4AF4E64CE46D9B067C335B1E11AA6FB3E4B0735B85A1496A0C4E7198C85DC3CB65741008BA25AD451919823F51265D7DB9032CBAE66B0B1CA92D8CE1571C2B0584FE84D02229DB78B7F350A440DA89C67E96D9427E3F7AE8FA0287ECDF2F02750DCED7CE86B18943956DE3502C976E7D43EDE619D7D5F2637C4DACE476BB2A5B9FA35C3560C9BA33729E9351AEF6D167CC94AF4260D89CB748D02D1833204986438B5C1BAC0C20CC3F3AC247ECA189790D8DD8160D971A995FEC8790CA2441E7891D154CD8217C2B6086E13D76CEB22BDCD3651AA1E52D52C1D52DF221D12D56C3B2402A21E1169950EA86B908EA76F7571220DE3E6110EA5DC1BD6FA9E4E0E65272E0EFE64D7F7D99D1C74279D823399B920003BDF8D2A4A3F83B89CD31A2AA333635BC847610A53E9AC289511735494AAEFB3A20C2A4AC527FCEC3E0AE770BB1A4298033BA735EDF98C565B8CB66999B6487671676D21A88ECA42BA3EEBCA2C9B0A61F5745259AFB9CE55ABDF90B86AD50F994CF6AD2E571C631C47E568C62B88A3723C2B869162CC1CC71171188850F462AF8C5018A53011B45745910551350CD5DDBB7837C94E13C7F79EFD4565CD6BE9CD00E63D96C3688B250F8F78E59F089CB522D9314B43B2160096EC5F04B258A0614E240A90F3B002AB48942251FAA33488B620B6660A8764A849646D3B9A7CCB6BB8852951026B76990C86BB6013C7D591E7747F8891CB0525977A71E59C7D959CA83CFF5E26A8C876480E94B04A51ABF78D21B176922FF910669025394B4D08B77EC8DE0486F277752B2B737E598169223C3B81911D7DCD2C30E21066121891A54F4260FA3D59B7B012BF9415977A57B79316C9AEDF83CA0027141381F64C522230D2846E1B99EC5748068D8A245C984848F66A518411CC292A4FCA9E68CEFAF55EAEFE4B12D97A6B9C6A9D4499DC33CC285EC3C399CD73D62DC113113CED2758E66116DF7586C84E20A915462BD99F28B25331652F919D8A5D8719D9D5C713B80FC23D604E7FE1441EC207D957B8788ACD0958D19CC1F0D24440D710293FCEEE4F45F4470382982A818D400701C55B6305A820EA06C07A342388F6530401870AA30D60DACF07A4304D706500D35CF94B516A776A00440520ED4C49708F60F2493FD5D13C1180573DA7E3B66EBEBCA80A9AED74B426876F66CD1FFCB2EC33602D7F9F2BB251770864720C448D9F166E0D7314073F1CD054B3A7EFE7E4B3579D68989C6970836E757260F692538C1DCD9E3A10974F5E119D1BC4E7DC881B333030733122A760A4106326AE5B7545C4691073BA4F7CD72BAEFB144A6540878329DB708A9B98A5D1D4864E3BE3993EB9C264F3D1C703AE11C1349B8FD2FBB7582A0D6BDB0BB2CE03EDDA968BBA0A40F360B950940B58BE03DB6D946EA8F201CD136F5DD70E38FF666D9F509FD4188B80590DDE5FEE28A12C071BC8B562D278A417515E2072F37B03C8E5E5799808AF31FEB6C2656A49295C6A714D5B9FAAED487EA7DC7BC3D47E49DCD2005EE01993B7AAC9434A1C0C713C52E701C42097DC409F677199A4EA084DDD9B0BA168A081E84A8DD96716D070FD5373A43AAAA15164718E0E814998A0819806116FB9E0964D882D0589E1749897445B39DD8D8C4E219FB3C9669BE7CD4865FBD01CA7CDDAA661DA67E6287DDE3633A3EEE9C1C890C1F6E828477C14EF2A4B8338BB91273EF98D46E2DBF66B41EB445EC65C554FCC11A82C5E1A867A6C8ED526F2D240ED33731419D7D5DCDEA3EE4CAC30A3B4E469AB0693F94943320D36AA462573B28A463558E051E9990C1CF5DC5AE5941E87AC7D1F4E55938F49C3348F2C31A8943E018C6AB3E0209375C9F08E69B1904036B5929141B6C962947402253348BAC1094FC151F91BE614C494491A5D6CB5904A317992114FB1D9015B3266BECDD68630F995A225619AEDB638D163ED9F1ED436D71C1F4FB0D7F59729F65B9DA6EF6E763A3B3744854225ADD140D4634BAC262D4D006B9E1F94E43447EF13494E7D7FE626398ABEBB911C2E878B35474C9385EDA733B518934F377C854E767D943F9108C92E550C2548DEF5904D4FFB01218DA2FAA8706F4B3CD9F23A2EED9CCB6A7E48B9D3C510AE06F8573AEADD15017715B06C8EE587CB0B0BE7F4F52BBED79A2DBC9E8F388A4DEA455CFF129FC71139E9E95E7807D2E81616A8CED8F24F8F4F4EB9EAC4875329785114612CB9D6182C17CC2EDE0C39681161F16096D91405EA2269BDC1CB34840F2BFFDF55CF33EFF25F9F99CE47DE871CAFFD9977ECFD6774BDA27B90077720170A168DA8D19B4A31BFB5079594699262D74578B5E023AAD17E25E2C7567B55B0716429D76AE4230BB9CA0572E2F5D51E9D3FD9359697A5BB89362EEB7220F68A2EC6498E12D124C5386F227B86B085385D10D87531E565DDCB82892E0523FF1F1440CDEBCBE23A8D7E2931BFAFF2123A48A9A438A3CC8E39EC8192CA8B536DAF62594517A15697547441B3774F8CAB1AF22EC49F12F0F0672724A1089F13DF24B511470D4D5AFF7014A2A4C6E1547893B05055C3D049F054F50B659B8EC964E5F50C5D86A6AC65E8B2ADF7C7E8D60BEA5037EEEBD85666DAB745C24251B751EA27166EDBD5E24B0E949FECE24B6B8E8D3383625DB1517887E656CA0F849FAC00EC4DFBD9EA5BA684EB5EBB58D7AF684D27DE01775B58698769B6341FF65F2C692FA9B3E211B382F0132A8044E7773A26EF4BB2DF5C2B288DAC03306B79A3C34FECD72500EE52049A045DB79A484F4404541F511CA0080C1729AA9328ADEB078959808E456B9CD65C7151BDB36A325F4BB1A1C9D57DEE859F5FD98D977FAFBA3EAA80D004B2A0283CB1D72A2C73498969BACE418ACC34A57FA68E3D0E4B90F6127BB8C8D3A194E811338BF9E5664BAD28C2C93E8AD6879DF5F7502B3FBCC9B0A4D451B95BCD1E89E80E0FC2700086C405C1560C40784F3D08E155E3810C1405D2931CA44305870219AA4D46856A3620D2841F52224D9B8A885DC1216DBD211509E36A44CA624432E4A755A68829D930A83A26A7553A3CA92DD86B112251E5F8DC441D0B0445E2B23DA699EA441587C64F9551672E3D619AA94E525E8856D9FE3BE9A1C909BD9426628F0584C6AFE12EA7396BB920170668777A4DEAFE54ACD96F55A0D1B67E978CB3A8F9237EC08F1DE932255F81D47FBD8645B4E9219618338501E34277EF5CA6B759EBD073236A5FE12EA7DE410442EC5FBFCA51740B02849BC90720D57F54525DDF93CF906E6078997E28D1B64478CA30B989990C271211E8E857858DD8312F3F545F6F15534C010F33221FCE7C487F28A338ECC67D21B97E54409050A3B9F1236B89C8CDDFE6B14312FFCB641550C3BE2E42BA82C936C660C587740DEEA1CBD8B014BE851B103CF6DF05A84086178265FBF275043639488A06A3EF8FFFC4321C260FDFFD0F04FEB4BE4C8B0000 , N'6.1.3-40302')
